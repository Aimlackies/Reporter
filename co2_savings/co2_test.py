from co2 import co2Savings
from datetime import datetime, timedelta
import pytest

def test_co2Savings():
    #generate some test data
    testData = {'2021-04-26 00:00': 2.2,
                '2021-04-26 00:30': 2.0,
                '2021-04-26 01:00': 1.9,
                '2021-04-26 01:30': 1.9,
                '2021-04-26 02:00': 1.9,
                '2021-04-26 02:30': 1.9,
                '2021-04-26 03:00': 1.9,
                '2021-04-26 03:30': 1.9,
                '2021-04-26 04:00': 1.9,
                '2021-04-26 04:30': 2.0,
                '2021-04-26 05:00': 2.0,
                '2021-04-26 05:30': 2.5,
                '2021-04-26 06:00': 2.7,
                '2021-04-26 06:30': 3.1,
                '2021-04-26 07:00': 3.1,
                '2021-04-26 07:30': 3.5,
                '2021-04-26 08:00': 3.3,
                '2021-04-26 08:30': 4.2,
                '2021-04-26 09:00': 6.8,
                '2021-04-26 09:30': 8.2,
                '2021-04-26 10:00': 9.9,
                '2021-04-26 10:30': 9.7,
                '2021-04-26 11:00': 9.9,
                '2021-04-26 11:30': 9.5,
                '2021-04-26 12:00': 8.5,
                '2021-04-26 12:30': 8.9,
                '2021-04-26 13:00': 8.2,
                '2021-04-26 13:30': 9.9,
                '2021-04-26 14:00': 9.1,
                '2021-04-26 14:30': 9.3,
                '2021-04-26 15:00': 10.2,
                '2021-04-26 15:30': 9.9,
                '2021-04-26 16:00': 8.2,
                '2021-04-26 16:30': 7.6,
                '2021-04-26 17:00': 6.9,
                '2021-04-26 17:30': 5.8,
                '2021-04-26 18:00': 4.9,
                '2021-04-26 18:30': 4.5,
                '2021-04-26 19:00': 3.9,
                '2021-04-26 19:30': 2.8,
                '2021-04-26 20:00': 2.5,
                '2021-04-26 20:30': 2.3,
                '2021-04-26 21:00': 2.3,
                '2021-04-26 21:30': 2.2,
                '2021-04-26 22:00': 2.2,
                '2021-04-26 22:30': 2.2,
                '2021-04-26 23:00': 2.1,
                '2021-04-26 23:30': 2.0
                }
    #use test data to test API calls
    co2 = {}
    for key in testData:
        date_obj = datetime.strptime(key, '%Y-%m-%d %H:%M')
        co2[key] = co2Savings(date_obj, testData[key])
    return co2

    #calculate the sum of all CO2 savings
    kg = sum(co2.values())/1000

    #check CO2 savings are the expected value
    assert kg == 78.81579999999998
